<%- include('../../partials/header.ejs') %>

<%- include('../../partials/cep.ejs') %>

<script type="text/javascript">
    $("#Celular").mask("(00) 00000-0000");
    $("#SegundoTelefone").mask("(00) 00000-0000");
    $("#dataabertura").mask("00/00/0000");
    $("#datasituacao").mask("00/00/0000");

    
</script>

    <div id="wrapper">
        <!-- Sidebar -->

            <!-- Content Wrapper -->
            <div id="content-wrapper" class="d-flex flex-column">
                <!-- Main Content -->
                <div id="content">
                    <!-- Topbar -->
                    <%- include('../../partials/topbar.ejs') %>
                        <!-- Begin Page Content -->
                        <div class="container-fluid">

                                                                    
                            <form method="POST" action="/admin/processos/update">
                                                                    <input  type="hidden" class="form-control"  name="id" id="id" value="<%= processo.id %>"></input>
                                                                    <input type="hidden" type="number" class="form-control" name="numprocesso" id="numprocesso"value="<%= processo.processo %>"></input>

                                                                        <!-- Content Row -->
                                                                    <div class="row">
                                                                        <!-- Earnings (Monthly) Card Example -->
                                                                        <div class="col-xl-12 col-md-6 mb-4">
                            
                                                                            <div class="card shadow mb-4">
                                                       
                                                                                <div class="card-body">
                                                                                    
                                                                                    
                                                                                     
                                                                                        
                                                                                        <div class="form-row">


                                    
                                                                                                
                                                                                                <div class="col-xl-6 col-md-6 mb-4">
                                                                                                    <small id="passwordHelpBlock" class="form-text text-muted">Atividade</small>
                                                                                                    <select class="form-control form-control-sm" name="atividade">
                                                                                                        <option value="<%= processo.atividade %>"><%= processo.atividade %></option>
                                                                                                        <option value=""></option>
                                                                                                        <option value="LOAS IDOSO">LOAS IDOSO</option>
                                                                                                        <option value="LOAS DEFICIENTE">LOAS DEFICIENTE</option>
                                                                                                        <option value="LOAS NIVER">LOAS NIVER</option>
                                                                                                        <option value="OUTROS">OUTROS</option>

                                                                                                        

                                                                                                        <option value="APOIO MARITIMO E NAVEGAÇÃO">APOIO MARITIMO E NAVEGAÇÃO</option>
                                                                                                        
                                                                                                        <option value="OUTROS">OUTROS</option>
                                                                                                    </select>
                                                                                                    
                                                                                                </div>
                                                                                                <div class="col-xl-1 col-md-6 mb-4">
                                                                                                    <small id="passwordHelpBlock" class="form-text text-muted">ATC M²</small>
                                                                                                    <input type="text" class="form-control form-control-sm" name="atc" value="<%= processo.atc %>" ></input>
                                                                                                </div>
                                
                                                                                                <div class="col-xl-1 col-md-6 mb-4">
                                                                                                    <small id="passwordHelpBlock" class="form-text text-muted">Vagas</small>
                                                                                                    <input type="text" class="form-control form-control-sm" name="vagas" value="<%= processo.vagas %>"></input>
                                                                                                </div>

                                                                                            
                                                                                                <div class="col-xl-4 col-md-6 mb-4">
                                                                                                    <small id="passwordHelpBlock" class="form-text text-muted">Código Padrão do CUB</small>
                                                                                                    <select class="form-control form-control-sm" name="codigocub">

                                                                                                        
                                                                                                        <option value="<%= processo.codigocub %>"><%= processo.codigocub %></option>
                                                                                                        <option value="SBTIB">SBT-IB</option>
                                                                                                        <option value="AC">ANTÔNIO CARLOS</option>
                                                                                                        <option value="TUPI">TUPI</option>
                                                                                                        <option value="CIDINHA">CIDINHA</option>
                                                                                                        <option value="PA">PEDRO AUGUSTO</option>
                                                                                                        <option value="CM">CM</option>
                                                                                                        <option value="PANFLETO">PANFLETO</option>
                                                                                                        <option value="AMIGOVIZINHO">AMIGO/VIZINHO</option>
                                                                                                        <option value="HR">HR</option>
                                                                                                        <option value="IBT">IBT</option>
                                                                                                        <option value="GLOBO">GLOBO</option>
                                                                                                    </select>
                                                                                                </div>
                                                                                        </div>
                            
                            
                                                                                        <div class="form-row">
                                                                                            
                                                                                            <div class="col-xl-1 col-md-6 mb-4">
                                                                                                <small id="passwordHelpBlock" class="form-text text-muted">Cep</small>
                                                                                                <input type="text" maxlength="9" class="form-control form-control-sm" name="cep"  id="cep" value="<%= processo.cep %>" size="10" onblur="pesquisacep(this.value);"></input>
                                                                                            </div>
                            
                                                                                            <div class="col-xl-3 col-md-6 mb-4">
                                                                                                <small id="passwordHelpBlock" class="form-text text-muted">Logradouro</small>
                                                                                                <input style="text-transform: uppercase;" id="logradouro" class="form-control form-control-sm" name="logradouro" value="<%= processo.logradouro %>"></input>
                                                                                            </div>
                            
                                                                                            <div class="col-xl-1 col-md-6 mb-4">
                                                                                                <small id="passwordHelpBlock" class="form-text text-muted"><input type="button"  value="copiar"  class="btn btn-white"  title="Copiar Enderecço do Requerente" onclick="mesmoendereco(event, this)"/></small>
                                                                                                    
                                                                                                
                                                                                                <script>
                                                                                                    function mesmoendereco(event, form) {     
                                                                                                        event.preventDefault();    
                                                                                                        
                                                                                                        var decision = confirm("Copiar o Endereço acima?");
                                                                                                        if (decision) {
                                                                                                            document.querySelector("[name='logradouro']").value = document.querySelector("[name='sicoplogradouro']").value;
                                                                                                    document.querySelector("[name='numero']").value = document.querySelector("[name='sicopnumerologr']").value;
                                                                                                    document.querySelector("[name='complemento']").value = document.querySelector("[name='sicopcomplemento']").value;
                                                                                                    document.querySelector("[name='bairro']").value = document.querySelector("[name='sicopbairro']").value;
                                                                                                    document.querySelector("[name='cep']").value = document.querySelector("[name='sicopcep']").value;
                                                                                                        }
                                                                                                    
                                                                                                                                                                                }
                                    
                                                                                                    </script>
                                                                                            </div>

                                                                                            <div class="col-xl-1 col-md-6 mb-4">
                                                                                                <small id="passwordHelpBlock" class="form-text text-muted">Número</small>
                                                                                                <input id="numero" type="number" class="form-control form-control-sm" name="numero" value="<%= processo.numero %>"></input>
                                                                                            </div>
                            
                                                                                            <div class="col-xl-2 col-md-6 mb-4">
                                                                                                <small id="passwordHelpBlock" class="form-text text-muted">Complemento</small>
                                                                                                <input style="text-transform: uppercase;" id="complemento" class="form-control form-control-sm" name="complemento" value="<%= processo.complemento %>"></input>
                                                                                            </div>
                            
                                                                                            
                                                                                            <div class="col-xl-2 col-md-6 mb-4">
                                                                                                <small id="passwordHelpBlock" class="form-text text-muted">Bairro</small>
                                                                                                <input style="text-transform: uppercase;" id="bairro" class="form-control form-control-sm" name="bairro" value="<%= processo.bairro %>"></input>
                                                                                            </div>

                                                                                            <div class="col-xl-2 col-md-6 mb-4">
                                                                                                <small id="passwordHelpBlock" class="form-text text-muted">Cidade</small>
                                                                                                <input style="text-transform: uppercase;" id="cidade" class="form-control form-control-sm" name="cidade" value="<%= processo.cidade %>"></input>
                                                                                            </div>
                            
                                                                       
                            
                                                                                          
                            
                                                                                            
                                                                                        </div>
                            
                                                       
                                                                                        <div class="form-row">
                                                                                            <div class="col-xl-3 col-md-6 mb-4">
                                                                                                <small id="passwordHelpBlock" class="form-text text-muted">E-mail</small>
                                                                                                <input style="text-transform: lowercase;" type="text" class="form-control form-control-sm" name="email" value="<%= processo.email %>" ></input>
                                                                                            </div>
                            
                                                                                            <div class="col-xl-3 col-md-6 mb-4">
                                                                                                <small id="passwordHelpBlock" class="form-text text-muted">Contato Requerente</small>
                                                                                                <input class="form-control form-control-sm" name="contatorequerente" value="<%= processo.contatorequerente %>" ></input>
                                                                                            </div>

                                                                                            <% var coramarelo = 'background-color:#FFFF00;cursor: pointer;text-decoration:none; color:currentColor; textcolor:currentColor;' %>
                                                                                            <% var cornormal = '' %>
                                                                                            <% var cordefundo = processo.situacao === "Em Andamento" ? cornormal : coramarelo    %>
                                                                                            <div style=<%= cordefundo %> class="col-xl-4 col-md-2 mb-4">
                                                                                                <small id="passwordHelpBlock" class="form-text text-primary">Situação do Processo</small>
                                                                                                <select class="form-control bg-primary text-white form-control-sm" name="situacao">
                                                                                                    <option value="<%= processo.situacao %>"><%= processo.situacao %></option>
                                                                                                    <option value=""></option>
                                                                                                    <option value="ANALISE">ANÁLISE</option>
                                                                                                    <option value="ANALISEPENDENCIA">ANÁLISE PENDÊNCIA</option>
                                                                                                    <option value="CANCELADO">CANCELADO</option>
                                                                                                    <option value="DEFERIDO">DEFERIDO</option>
                                                                                                    <option value="INDEFERIDO">INDEFERIDO</option>
                                                                                                    <option value="EXIGENCIA">EXIGÊNCIA</option>
                                                                                                    <option value="FALECEU">FALECEU</option>
                                                                                                    <option value="RECURSO">RECURSO</option>
                                                                                                    <option value="OUTROS">OUTROS</option>


                                                                                                    
                                                                                                </select>
                                                                                                
                                                                                             
                                                                                                    
                                                                                                
                                                                                            </div>

                                                                                            <div style=<%= cordefundo %> class="col-xl-2 col-md-2 mb-4">
                                                                                                <small id="passwordHelpBlock" class="form-text text-primary">Data da Situação</small>
                                                                                                <input type="text" class="p-3 mb-2 bg-primary text-white form-control form-control-sm" name="datasituacao" id="datasituacao" value="<%= processo.datasituacao %>" ></input>
                                                                                                
                                                                                            </div>
                            
                                                                                        
                                                                                                       
                                                                                        </div>

                                                                                        <div class="form-row">
                                                                                            <div class="col-xl-12 col-md-6 mb-4">
                                                                                                <small id="passwordHelpBlock" class="form-text text-muted">Informações do CardFile Antigo</small>
                                                                                               <textarea type="text" class="p-3 mb-2 bg-light text-dark font-italic form-control form-control-sm" name="cardfile" id="cardfile" value="<%= processo.cardfile %>" rows="7" cols="66"><%= processo.cardfile %></textarea>
                                                                                            </div>

                                                                                            
                                                                                        </div>

                                                                                        <div class="form-row">

                                                                                        <div class="col-xl-1 col-md-6 mb-4">
                                                                                            <small id="passwordHelpBlock" class="form-text text-muted">Latitude</small>
                                                                                            <input class="form-control form-control-sm" name="latitude" value="<%= processo.latitude %>"></input>
                                                                                        </div>
                        
                                                                                        <div class="col-xl-1 col-md-6 mb-4">
                                                                                            <small id="passwordHelpBlock" class="form-text text-muted">Longitude</small>
                                                                                            <input class="form-control form-control-sm" name="longitude" value="<%= processo.longitude %>"></input>
                                                                                        </div>

                                                                                    </div>

                                                                                        <div class="form-row">
                                                                                                        <div class="col-xl-6 col-md-6 mb-4">
                                                                                                            
                                                                                                            <button type="submit" class="btn btn-success btn-block" >Atualizar</button>
                                                                                                        </div>

                                                                                                        <div class="col-xl-2 col-md-6 mb-4">
                                                                                                            
                                                                                                            <a href="https://computei.com.br/certidao/<%= processo.processo %>.doc" target="_parent" class="btn btn-light btn-block"><i class="far fa-file-word"></i> Baixar Declaração</a>
                                                                                                            

                                                                                                        </div>

                                                                                                        <div class="col-xl-4 col-md-6 mb-4">
                                                                                                            
                                                                                                            <a href="/admin/tramitacoes/<%= processo.processo %>"><button class="btn btn-light btn-block" title="Registrar Tramitações" btn-block><i class="fas fa-book"></i> Tramitações</button></a>
                                                                                                        </div>
                                                                                                        
                                                                                                        
                                                                                        </div>

                                                                                    
                                                                                </div>
                            
                                                                                
                                                                            </div>
                            
                                                                        
                                                                    </div>
                                </form>
                            
                            
                                                                        
                            
                                                        </div>

                                                                
                </div>

<!-- Footer -->
<footer>
    <div class="container my-auto">



        <div class="copyright text-center my-auto">


            <div class="row">

                <!-- Earnings (Monthly) Card Example -->
                <div class="col-xl-6 col-md-6 mb-4">
                    <input type="button" value="Voltar" onClick="history.go(-1)" class="btn btn-Light btn-block" />
                </div>
                <div class="col-xl-6 col-md-6 mb-4">
                    <input type="button" value="Avançar" onClick="history.go(+1)" class="btn btn-Light btn-block" />
                </div>


            </div>
        </div>
</footer>



</div>


<a class="scroll-to-top rounded" href="#page-top"><i class="fas fa-angle-up"></i></a>
</div>


 <script type="text/javascript">

var Platitude = document.querySelector("[name='Platitude']").value;
var Plongitude = document.querySelector("[name='Plongitude']").value;
var Pendereco = document.querySelector("[name='Pendereco']").value;

console.log(Platitude);
console.log(Plongitude);
console.log(Pendereco);

    const map = L.map('map').setView([Platitude,Plongitude], 15);
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    
 



   if (document.querySelector("[name='situacao']").value === "Em Andamento") {
    var icone = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});      
   }else{
    var icone = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-yellow.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});

   }

   


    L.marker([Platitude,Plongitude], {icon: icone}).addTo(map)
    .bindPopup(Pendereco)
    .openPopup();
    
    
    
    // se estÃ¡ clicado
    let isFetching = false
    
    
    
    map.on("click", async e => {
    
    // para evitar muitos cliques
    if(isFetching) return
    
    isFetching = true
    
    const {lat, lng} = e.latlng
    
    const link = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&addressdetails=1&format=jsonv2&`
    
    const data = await fetch(link)
    .then(response => response.json())
    .catch(error => false)
    console.log(data)
    
    document.querySelector("[name='logradouro']").value = `${data.address.road}`;
    document.querySelector("[name='numero']").value = `${data.address.house_number}`;
    document.querySelector("[name='bairro']").value = `${data.address.suburb}`;
    document.querySelector("[name='cidade']").value = `${ data.address.city===undefined ? data.address.municipality : data.address.city }`;
    document.querySelector("[name='cep']").value = `${data.address.postcode}`;
    document.querySelector("[name='latitude']").value = `${data.lat}`;
    document.querySelector("[name='longitude']").value = `${data.lon}`;
    
    setTimeout(() => isFetching = false, 1500)
    })
    </script>



    <%- include('../../partials/logoutmodal.ejs') %>
    <%- include('../../partials/footer.ejs') %>
